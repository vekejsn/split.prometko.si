window.onload = async function () {
    let data = await fetch('https://api.prometko.cyou/prometSplit/buses/locations').then(res => res.json()).then(res => res.data);
    let busData = await fetch('./buses.json').then(res => res.json());
    let table = document.getElementById('table');
    // sort the data by data[i].vehicle.name
    await data.sort((a, b) => {
        if (a.name < b.name) return -1;
        if (a.name > b.name) return 1;
        return 0;
    });
    // iterate through the data and create a element
    for (let i = 0; i < data.length; i++) {
        // find bus with same name
        let bus = await busData.find(bus => parseInt(bus.id) == parseInt(data[i].name.replace(/[^\d-]/g, "")));
        // console.log(bus);
        // create a card for the bus
        let card = document.createElement('div');
        card.className = 'card margin-bottom';
        // create a card body for the bus
        let cardBody = document.createElement('div');
        cardBody.className = 'card-body';
        // create a card title for the bus
        let cardTitle = document.createElement('h5');
        cardTitle.className = 'card-header';
        cardTitle.innerHTML = `<b>${data[i].name.replace(/[^\d-]/g, "")}</b>` + ` <small>${bus.plates}</small>`;
        // add a text that will float to the right of the card title
        // create a card text for the bus
        let diver = document.createElement('div');
        diver.className = 'row justify-content-between';
        let cardText = document.createElement('p');
        cardText.className = 'card-text col-md-9';
        cardText.innerHTML = `<b>Model: </b>${bus.model}<br>`;
        cardText.innerHTML += `<b>Status: </b>${data[i].departureTime ? "Aktivan" : "<em>Neaktivan</em>"}<br>`;
        cardText.innerHTML += `<hr class="vehicleinfo">`;
        if (data[i].departureTime) {
            cardText.innerHTML += `<p class="vehicleinfo"><b>Linija: </b><b class="route_name_number">${data[i].routeCode}</b> ${data[i].tripName}</p>`;
            cardText.innerHTML += `<hr class="vehicleinfo">`;
        } else {
            cardText.innerHTML += `<p class="vehicleinfo"><b>Zadnja linija: </b><b class="route_name_number">${data[i].routecode}</b> ${data[i].tripname}</p>`;
            cardText.innerHTML += `<hr class="vehicleinfo">`;
        }
        cardText.innerHTML += `<p class="vehicleinfo"><b>Zabilje≈æen: </b>${new Date(data[i].timestamp).toLocaleString('sr-RS').split(" ").reverse().join(", ")}</p>`;
        diver.appendChild(cardText);
        let imgdiv = document.createElement('div');
        imgdiv.className = 'col-md-3';
        let img = document.createElement('img');
        img.className = 'img-fluid';
        img.src = bus.imageUrl;
        imgdiv.appendChild(img);
        diver.appendChild(imgdiv);

        // append everything to the card body
        card.appendChild(cardTitle);
        cardBody.appendChild(diver);
        // append everything to the card
        card.appendChild(cardBody);
        // append the card to the table
        table.appendChild(card);

    }
}

let burek = async () => {
    // load buses.json
    let busData = await fetch('./buses.json').then(res => res.json());
    // parse data
    data = JSON.parse(data);
    // iterate through data
    for (let i = 0; i < data.length; i++) {
        let bus = await busData.find(bus => parseInt(bus.id) == parseInt(data[i].id));
        bus.imageUrl = data[i].link.length > 0 ? data[i].link : bus.imageUrl;
    }
    console.log('doner');
    console.log(busData);
}

burek();

let data = `[{ "id": "197", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=64181;image" }, { "id": "198", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=62366;image" }, { "id": "214", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=55540;image" }, { "id": "215", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=75743;image" }, { "id": "216", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=69443;image" }, { "id": "217", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=85851;image" }, { "id": "218", "link": "" }, { "id": "220", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54589;image" }, { "id": "221", "link": "" }, { "id": "222", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56931;image" }, { "id": "223", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56495;image" }, { "id": "224", "link": "" }, { "id": "225", "link": "" }, { "id": "226", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=73824;image" }, { "id": "227", "link": "" }, { "id": "228", "link": "" }, { "id": "229", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=60688;image" }, { "id": "231", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=44603;image" }, { "id": "232", "link": "" }, { "id": "234", "link": "" }, { "id": "235", "link": "" }, { "id": "238", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=50212;image" }, { "id": "240", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56508;image" }, { "id": "243", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54593;image" }, { "id": "244", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54592;image" }, { "id": "245", "link": "" }, { "id": "246", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=73818;image" }, { "id": "248", "link": "" }, { "id": "249", "link": "" }, { "id": "250", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=63181;image" }, { "id": "251", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=73505;image" }, { "id": "252", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=69146;image" }, { "id": "253", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83545;image" }, { "id": "254", "link": "" }, { "id": "256", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=51506;image" }, { "id": "257", "link": "" }, { "id": "258", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23177.0;attach=30072;image" }, { "id": "259", "link": "" }, { "id": "260", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=82535;image" }, { "id": "262", "link": "" }, { "id": "263", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56766;image" }, { "id": "264", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54600;image" }, { "id": "265", "link": "" }, { "id": "266", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54602;image" }, { "id": "267", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83488;image" }, { "id": "268", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=45691;image" }, { "id": "269", "link": "" }, { "id": "270", "link": "" }, { "id": "271", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56491;image" }, { "id": "272", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83560;image" }, { "id": "273", "link": "" }, { "id": "274", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=58957;image" }, { "id": "275", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=60894;image" }, { "id": "276", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=70892;image" }, { "id": "277", "link": "" }, { "id": "278", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=60840;image" }, { "id": "279", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=41420;image" }, { "id": "280", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=61470;image" }, { "id": "281", "link": "" }, { "id": "282", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=50197;image" }, { "id": "283", "link": "http://www.autobusi.org/forum/index.php?action=dlattach;topic=21752.0;attach=12089;image" }, { "id": "284", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=71505;image" }, { "id": "285", "link": "" }, { "id": "286", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=69131;image" }, { "id": "287", "link": "" }, { "id": "288", "link": "" }, { "id": "289", "link": "" }, { "id": "290", "link": "" }, { "id": "291", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=58939;image" }, { "id": "292", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=74731;image" }, { "id": "293", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=77449;image" }, { "id": "294", "link": "http://www.autobusi.org/forum/index.php?action=dlattach;topic=21752.0;attach=13339;image" }, { "id": "295", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=73811;image" }, { "id": "296", "link": "" }, { "id": "297", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56528;image" }, { "id": "298", "link": "" }, { "id": "299", "link": "" }, { "id": "300", "link": "http://www.autobusi.org/forum/index.php?action=dlattach;topic=21752.0;attach=9731;image" }, { "id": "301", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=44565;image" }, { "id": "305", "link": "http://www.autobusi.org/forum/index.php?action=dlattach;topic=21752.0;attach=12051;image" }, { "id": "307", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=85315;image" }, { "id": "308", "link": "" }, { "id": "309", "link": "" }, { "id": "310", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=70889;image" }, { "id": "311", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=61240;image" }, { "id": "312", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=77464;image" }, { "id": "313", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83565;image" }, { "id": "314", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=44589;image" }, { "id": "315", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=44616;image" }, { "id": "316", "link": "" }, { "id": "317", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=69142;image" }, { "id": "318", "link": "" }, { "id": "1", "link": "" }, { "id": "2", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=55536;image" }, { "id": "3", "link": "" }, { "id": "4", "link": "" }, { "id": "5", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=51504;image" }, { "id": "6", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=42146;image" }, { "id": "7", "link": "" }, { "id": "8", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=75773;image" }, { "id": "9", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56532;image" }, { "id": "10", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=57641;image" }, { "id": "11", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54599;image" }, { "id": "12", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=74728;image" }, { "id": "13", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83540;image" }, { "id": "14", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=75781;image" }, { "id": "15", "link": "" }, { "id": "16", "link": "" }, { "id": "17", "link": "" }, { "id": "18", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=77426;image" }, { "id": "19", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=50194;image" }, { "id": "20", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=85533;image" }, { "id": "21", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=51505;image" }, { "id": "22", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83523;image" }, { "id": "23", "link": "" }, { "id": "24", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=45958;image" }, { "id": "25", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=50215;image" }, { "id": "26", "link": "" }, { "id": "27", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=45947;image" }, { "id": "28", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=70891;image" }, { "id": "29", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=44296;image" }, { "id": "30", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83542;image" }, { "id": "31", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=73492;image" }, { "id": "32", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=23789.0;attach=44608;image" }, { "id": "33", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=58949;image" }, { "id": "34", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54604;image" }, { "id": "35", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=58950;image" }, { "id": "36", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=62157;image" }, { "id": "37", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56543;image" }, { "id": "38", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56763;image" }, { "id": "39", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=74737;image" }, { "id": "40", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=83537;image" }, { "id": "41", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54611;image" }, { "id": "42", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56743;image" }, { "id": "43", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=69134;image" }, { "id": "44", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54606;image" }, { "id": "45", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=71504;image" }, { "id": "46", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56530;image" }, { "id": "47", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=56513;image" }, { "id": "48", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=57048;image" }, { "id": "49", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=65405;image" }, { "id": "50", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54803;image" }, { "id": "51", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24639.0;attach=69444;image" }, { "id": "52", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24367.0;attach=54874;image" }, { "id": "53", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=86009;image" }, { "id": "54", "link": "" }, { "id": "55", "link": "" }, { "id": "56", "link": "" }, { "id": "57", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=85547;image" }, { "id": "58", "link": "" }, { "id": "59", "link": "" }, { "id": "60", "link": "" }, { "id": "61", "link": "" }, { "id": "62", "link": "" }, { "id": "63", "link": "" }, { "id": "64", "link": "" }, { "id": "65", "link": "" }, { "id": "66", "link": "" }, { "id": "67", "link": "" }, { "id": "68", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=19202.0;attach=85892;image" }, { "id": "69", "link": "" }, { "id": "70", "link": "" }, { "id": "71", "link": "" }, { "id": "72", "link": "https://www.autobusi.org/forum/index.php?action=dlattach;topic=24930.0;attach=85876;image" }]`;